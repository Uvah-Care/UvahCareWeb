<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <link rel="stylesheet" href="/css/main.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/e2cfeba165.js" crossorigin="anonymous"></script>
</head>
<body class="is-preload landing">
    <div id="page-wrapper">
        <!-- Header -->
        <header id="header">
            <h1 id="logo">
                <img class="logo-image" src="/images/Uvah care logo wb1-01.png" alt>
                <a href="/">UVAH CARE</a>
            </h1>
            <nav id="nav">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/experts">Experts</a></li>
                    <li><a href="/about">About us</a></li>
                    <li><a href="/contact">Contact us</a></li>
                    <li><a href="/user/profile" class="button primary"><i class="fa-solid fa-user"></i>&nbsp;&nbsp;<%=user.name%></a></li>
                    <li><a href="/user/logout" class="button primary">Logout</a></li>
                </ul>
            </nav>
        </header>

        <div id="main" class="wrapper style3">
            <div class="container">
                <header class="major">
                    <h2>Payment</h2>
                    <p>Do it for the sake of your mind and body</p>
                </header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>item</th>
                                <th>Description</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td><%=subscribe.title%></td>
                                <td><%=subscribe.cost%></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="2"></td>
                                <td><%=subscribe.cost%></td>
                            </tr>
                        </tfoot>
                    </table>
                    <ul class="actions row aln-middle ">
                        <li id="before-payment" class="col-3"><button id="rzp-button1" class="button primary fit">Pay</button></li>
                        <li id="after-payment" class="col-7" style="display: none;" > 
                            <ul class="actions stacked aln-center">
                                <h1>Payment Successful</h1>
                                <li><a href="/user/profile" class="button primary">Profile Page</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- show reciept here -->
        <!-- <h1>payment page</h1>
        <h3>amount : 500</h3>
        <button id="rzp-button1">Pay</button> -->

        
        <!-- Footer -->
        <footer id="footer" class="row">
            <div class="col-8 col-12-xsmall row">
                <div class="col-4 col-12-xsmall row aln-center">
                    <div class="col-12 col-12-xsmall align-center"><h1><a>Uvah Care</a></h1></div>							
                    <div class="col-9 col-12-xsmall"><span class="image fit"><img src="/images/Uvah care logo wb1-01.png"></span></div>
                    <div class="col-9 col-12-xsmall"><a href=" " target="_blank"><span class="image fit"><img src="/images/google-playstore.png"></span></a></div>
                </div>

                <div class="col-3 col-12-xsmall pad-left">
                                <ul class="actions stacked">
                                    <li><a href=""><h3>Contact Us</h3></a></li>
                                    <li><a href=""><h3>About Us</h3></a></li>
                                    <li><a href=""><h3>Our Experts</h3></a></li>
                                    <li><a href=""><h3>Need Help?</h3></a></li>
                                </ul>
                            </div>
                            <div class="col-4 col-12-xsmall pad-left">
                                <ul class="actions stacked">
                                    <!-- <li><h4>OUR TERMS</h4></li> -->
                                    <li><a href=""><h3>Privacy Policy</h3></a></li>
                                    <li><a href=""><h3>Terms and conditions</h3></a></li>
                                    <li><a href=""><h3>Terms of service</h3></a></li>
                                </ul>
                            </div>
            </div>
            
            <div class="footer-social col-4 col-12-xsmall">
                <h2>Social</h2>
                <ul class="icons actions">
                <li><a href="https://twitter.com/CareUvah?t=jb3rWQa-ldpURupJmfnQgw&s=08" class="icon"><i class="fa-brands fa-twitter"></i></a></li>
                <li><a href="https://www.facebook.com/pages/category/Medical---Health/UvahCare-113228164180677/" class="icon"><i class="fa-brands fa-facebook-f"></i></a></li>
                <li><a href="#" class="icon"><i class="fa-brands fa-linkedin-in"></i></a></li>
                <li><a href="https://www.instagram.com/uvah_care/" class="icon"><i class="fa-brands fa-instagram"></i></a></li>
                <li><a href="https://youtube.com/channel/UCAAxT_qT81CNMlY5kEhZZeA" class="icon"><i class="fa-brands fa-youtube"></i></a></li>
                <!-- <li><a href="#" class="icon"><i class="fa-brands fa-github"></i></a></li> -->
                <!-- <li><a href="#" class="icon"><i class="fa-solid fa-envelope"></i></a></li> -->
                </ul>
            </div>
            <ul class="col-12 col-12-xsmall copyright">
                <li>&copy; UVAH CARE. All rights reserved.</li>
            </ul>
        </footer>
    </div>



    <!-- Scripts -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/jquery.dropotron.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/browser.min.js"></script>
    <script src="/js/breakpoints.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
    <!-- RazorPay payment script   -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        var cost = "<%=(subscribe.cost)*100 %>" ;
        var orderId ;
        $(document).ready(function(){
            var settings = {
            "url": `/subscribe/create-payment-order/${cost}`,
            "method": "POST",
            "timeout": 0,
            "headers": {
            "Content-Type": "application/json"
            },
            "data": JSON.stringify({
                "amount": cost
            }),
            };
            //creates new orderId everytime
            $.ajax(settings).done(function (response) {
                orderId=response.orderId;
                console.log(orderId);
                $("button").show();
            });
        }); 

        var options = {
            "key": "rzp_test_cnNgV26a1zX99m", // Enter the Key ID generated from the Dashboard
            "amount": cost, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
            "currency": "INR",
            "name": "Uvah Care",
            "description": "Test Transaction",
            "image": "/images/Uvah care logo wb1-01.png",
            "order_id": orderId , //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
            // "callback_url": "/join/after-payment",
            "handler": function (response){ //if payment is complete 
                // alert(response.razorpay_payment_id);
                // alert(response.razorpay_order_id);
                // alert(response.razorpay_signature);
                alert('Payment complete');
                var settings = {
                    "url": `/subscribe/verify-payment/<%=subscribe.name%>`,
                    "method": "POST",
                    "timeout": 0,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({response}),
                }    
                $.ajax(settings).done(function (response) {
                    $('#before-payment').css({"display":"none"});
                    $('#after-payment').css({"display":""});
                    alert(JSON.stringify(response));
                })
                // response.redirect('/user/profile');
            },
            "prefill": {
                "name": "<%=user.name%>",
                "email": "<%=user.email%>",
                "contact": "<%=user.phone_no%>"
            },
            "notes": {
                "address": "Razorpay Corporate Office"
            },
            "theme": {
                "color": "#3399cc"
            }
        };
        var rzp1 = new Razorpay(options);
        // rzp1.on('payment.failed', function (response){
        //         alert(response.error.code);
        //         alert(response.error.description);
        //         alert(response.error.source);
        //         alert(response.error.step);
        //         alert(response.error.reason);
        //         alert(response.error.metadata.order_id);
        //         alert(response.error.metadata.payment_id);
        // });
        document.getElementById('rzp-button1').onclick = function(e){
            rzp1.open();
            e.preventDefault();
        }
    </script>
</body>
</html>